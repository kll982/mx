<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="logo1.ico">
    <title>江苏省水路行业安全生产风险管理与隐患治理信息系统</title>
    <script src="jquery.js"></script>
    <!-- <script src="http://www.jq22.com/jquery/jquery-migrate-1.2.1.min.js"></script> -->
    <!-- <script src="jquery.jqprint.js"></script> -->
    <!-- 210mm×297mm -->
    <!-- <link rel="stylesheet" href="dailyprint.css" type="text/css" media="print"> -->
    <link rel="stylesheet" href="dailyWatch.css">

</head>

<body>
    <div class="wrap">
        <div id="wrap">
            <div class="title">title</div>
            <header>
                <div class="leftHalf">
                    <!-- 所在乡镇： -->
                    <div class="block Township">
                        <span class="leftTitle">所在乡镇：</span>
                        <strong class="rightValue">value</strong>
                    </div>
                    <!-- 是否通航： -->
                    <div class="block navigable checkSortIdISNOT1">
                        <span class="leftTitle">是否通航：</span>
                        <strong class="rightValue checkSortIdIS2">通航水域</strong>
                        <strong class="rightValue checkSortIdIS3">非通航水域</strong>
                    </div>
                    <!-- 检查时间： -->
                    <div class="block checkTime">
                        <span class="leftTitle">检查时间：</span>
                        <strong class="rightValue">value</strong>
                    </div>
                    <!--当场纠正数量+限期整改-->
                    <div class="block danger">
                        <span class="leftTitle">隐患：</span>
                        <strong class="rightValue">value</strong>
                    </div>
                    <!-- 是否解决： -->
                    <div class="block isSolve">
                        <span class="leftTitle">是否解决：</span>
                        <strong class="rightValue">value</strong>
                    </div>
                </div>
                <div class="rightHalf">
                    <!--运营人：-->
                    <div class="block operator">
                        <span class="leftTitle checkSortIdIS1">运营人：</span>
                        <span class="leftTitle checkSortIdISNOT1">联系人：</span>
                        <strong class="rightValue">value</strong>
                    </div>
                    <!-- 运营人手机： -->
                    <div class="block operatorPhone">
                        <span class="leftTitle checkSortIdIS1">运营人手机：</span>
                        <span class="leftTitle checkSortIdISNOT1">联系人手机：</span>
                        <strong class="rightValue">value</strong>
                    </div>
                    <!--检查人：-->
                    <div class="block createBy">
                        <span class="leftTitle">检查人：</span>
                        <strong class="rightValue">value</strong>
                    </div>
                    <!-- 检查人单位： -->
                    <div class="block createMsaName">
                        <span class="leftTitle">检查人单位：</span>
                        <strong class="rightValue">value</strong>
                    </div>
                    <!-- 备案时间： -->
                    <div class="block recordTime checkSortIdISNOT1">
                        <span class="leftTitle">备案时间：</span>
                        <strong class="rightValue">value</strong>
                    </div>

                </div>
            </header>
            <div class="table">
                <!-- <div class="tableWrap"> -->
                    <!-- <h3 class="tableTitle">title</h3>
                    <div class="block borderTop">
                        <div class="subtitle">sub</div>
                        <div class="option">12</div>
                    </div>
                    <div class="borderBottom"></div>
                    <p class="problem ">问题描述：</p>
                    <div class="leftBlock"> -->
                    <!-- 问题描述： -->
                    <!-- <div class="block">
                            <span class="leftTitle">问题描述：</span>
                            <strong class="rightValue">value</strong>
                        </div> -->
                    <!-- 整改要求： -->
                    <!-- <div class="block">
                            <span class="leftTitle">整改要求：</span>
                            <strong class="rightValue">value</strong>
                        </div> -->
                    <!-- 现场图片： -->
                    <!-- <div class="block">
                                                <span class="leftTitle">现场图片：</span>
                                                <strong class="rightValue flex">
                                                    <div class="imgWrap">
                                                        <img src="https://ss0.baidu.com/94o3dSag_xI4khGko9WTAnF6hhy/image/h%3D300/sign=bb325138dc58ccbf04bcb33a29dabcd4/aa18972bd40735faee21b63393510fb30e240862.jpg"
                                                            alt="圆">
                                                    </div>
        
                                                    <div class="imgWrap">
                                                        <img src="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2078115416,2122881389&fm=11&gp=0.jpg"
                                                            alt="线">
                                                    </div>
                                                    <div class="imgWrap"><img src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=792977951,797098830&fm=11&gp=0.jpg"
                                                            alt="女"></div>
        
                                                    <div class="imgWrap"><img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3820340004,4042725193&fm=11&gp=0.jpg"
                                                            alt="男"></div>
        
        
                                                </strong>
                                            </div> -->
                    <!-- 位&nbsp;&nbsp;&nbsp;置： -->
                    <!-- <div class="block">
                            <span class="leftTitle">位&nbsp;&nbsp;&nbsp;置：</span>
                            <strong class="rightValue">Lorem ipsum dolor sit amet consectetur adipisicing
                                elit. Voluptates, vitae, doloribus unde quam deleniti ratione, cumque fugit
                                velit sint quisquam repellat soluta. Impedit saepe ipsam ipsum accusamus
                                laboriosam. Nam, voluptas.</strong>
                        </div>
                    </div>
                    <div class="rightBlock"> -->
                    <!-- 检查时间： -->
                    <!-- <div class="block">
                            <span class="leftTitle">检查时间：</span>
                            <strong class="rightValue">Lorem ipsum dolor sit amet consectetur adipisicing
                                elit. Voluptates, vitae, doloribus unde quam deleniti ratione, cumque fugit
                                velit sint quisquam repellat soluta. Impedit saepe ipsam ipsum accusamus
                                laboriosam. Nam, voluptas.</strong>
                        </div> -->
                    <!-- 复查时间： -->
                    <!-- <div class="block">
                            <span class="leftTitle">复查时间：</span>
                            <strong class="rightValue">Lorem ipsum dolor sit amet consectetur adipisicing
                                elit. Voluptates, vitae, doloribus unde quam deleniti ratione, cumque fugit
                                velit sint quisquam repellat soluta. Impedit saepe ipsam ipsum accusamus
                                laboriosam. Nam, voluptas.</strong>
                        </div>
                    </div> -->
                <!-- </div> -->

            </div>
            <footer class="footer">
                经营人(签字)： <span class="underline" style="text-decoration:underline"></span>
            </footer>
        </div>

        <input class="noprint printBtn" type="button" value="打印检查单" />
    </div>
</body>
<script language="javascript">
    window.obj = {};
    window.url = location.origin.replace("www", "bm");
    var chnNumChar = ["零", "一", "二", "三", "四", "五", "六", "七", "八", "九"],
        chnUnitSection = ["", "万", "亿", "万亿", "亿亿"],
        chnUnitChar = ["", "十", "百", "千"];
    getName();
    console.log("obj", obj);
    window.onload = function () {
        var str = "&nbsp;";
        for (var i = 0; i < 100; i++) {
            str += "&nbsp;";
        }
        $(".underline").append(str);
        // 获取值
        $.ajax({
            url: url + '/checklist/listDetailByDetailId',
            data: {
                detailId: obj.detailId,
            },
            xhrFields: {
                withCredentials: true
            },
            success: function (response) {
                if (response.code == 200) {
                    var datas = response.data.response.list;
                    window.datas = datas;
                    console.log("datas", datas);
                    if (datas.checkSortId == 1) {
                        $(".checkSortIdIS1").css("display", "inline-block");
                        $(".checkSortIdIS2").css("display", "none");
                        $(".checkSortIdIS3").css("display", "none");
                        $(".checkSortIdISNOT1").css("display", "none");
                    } else if (datas.checkSortId == 2) {
                        $(".checkSortIdIS1").css("display", "none");
                        $(".checkSortIdIS2").css("display", "inline-block");
                        $(".checkSortIdIS3").css("display", "none");
                        $(".checkSortIdISNOT1").css("display", "inline-block");
                    } else if (datas.checkSortId == 3) {
                        $(".checkSortIdIS1").css("display", "none");
                        $(".checkSortIdIS2").css("display", "none");
                        $(".checkSortIdIS3").css("display", "inline-block");
                        $(".checkSortIdISNOT1").css("display", "inline-block");
                    }
                    var data = datas.checklistDtos;
                    var children = [],
                        grade = {
                            parent: []
                        },
                        parent = [];
                    // 数据处理
                    if (data.length > 1) {
                        for (var i = 1; i < data.length; i++) {
                            var j = i - 1;
                            if (data[i].one == data[j].one) {
                                children.push(data[j]);
                            } else {
                                children.push(data[j]);
                                parent.push({
                                    one: data[j].one,
                                    children: children
                                });
                                children = [];
                            }
                            if (i == data.length - 1) {
                                children.push(data[data.length - 1]);
                                parent.push({
                                    one: data[data.length - 1].one,
                                    children: children
                                });
                                grade.parent = parent
                            }
                        }
                    } else {
                        children.push(data[0])
                        parent.push({
                            one: data[0].one,
                            children: children
                        });
                        grade.parent = parent;
                    }
                    console.log("grade", grade.parent);

                    // html
                    $(".title").text(datas.checklistTitle);
                    $(".Township .rightValue").text(datas.companyName);
                    $(".checkTime .rightValue").text(getDay(datas.uploadTime));
                    $(".danger .rightValue").html(danger());
                    $(".isSolve .rightValue").text(obj.isSolve == 1 ? "未解决" : "已解决");

                    $(".operator .rightValue").text(datas.operator == null ? "——" : datas.operator);
                    $(".operatorPhone .rightValue").text(datas.operatorPhone == null ? "——" : datas.operatorPhone);
                    $(".createBy .rightValue").text(datas.createBy == null ? "——" : datas.createBy);
                    $(".createMsaName .rightValue").text(datas.createMsaName == null ? "——" : datas.createMsaName);
                    $(".recordTime .rightValue").text(getDay(datas.recordTime));


                    // table
                    for (var i in parent) {
                        var I = Number(i) + 1;
                        var theader = '<div class="tableWrap"><h3 class="tableTitle">' +
                            SectionToChinese(I) +
                            '、 ' + parent[i].one + '</h3>';

                        var child = parent[i].children;
                        var tbody = "";
                        for (var l in child) {
                            console.log(child[l].optionId);
                            if (Number(child[l].optionId) == 1) {
                                $(".optionIdIS1").css("display", "inline-block");
                                $(".optionIdIS2").css("display", "none");
                                $(".optionIdIS3").css("display", "none");
                                $(".optionIdISNOT1").css("display", "none");
                            } else if (Number(child[l].optionId) == 2) {
                                $(".optionIdIS1").css("display", "none");
                                $(".optionIdIS2").css("display", "inline-block");
                                $(".optionIdIS3").css("display", "none");
                                $(".optionIdISNOT1").css("display", "inline-block");
                            } else if (Number(child[l].optionId) == 3) {
                                $(".optionIdIS1").css("display", "none");
                                $(".optionIdIS2").css("display", "none");
                                $(".optionIdIS3").css("display", "inline-block");
                                $(".optionIdISNOT1").css("display", "inline-block");
                            };
                            var images = child[l].urls;

                            console.log(images);
                            for (var k in images) {
                                console.log(k);
                            }
                            tbody +=
                                '<div class="block borderTop"><div class="subtitle">' + child[l].three +
                                '</div><div class="option">' + child[l].optionName +
                                '</div></div><div class="borderBottom"></div><p class="problem ">问题描述：</p><div class="leftBlock"><!-- 问题描述： --><div class="block"><span class="leftTitle">问题描述：</span><strong class="rightValue">' +
                                child[l].reviewDescribe +
                                '</strong></div><!-- 整改要求： --><div class="block optionIdIS3"><span class="leftTitle">整改要求：</span><strong class="rightValue">' +
                                child[l].reviewRequire +
                                '</strong></div><!-- 现场图片： --><div class="block"><span class="leftTitle">现场图片：</span><strong class="rightValue flex"><div class="imgWrap"> <img  src="https://ss0.baidu.com/94o3dSag_xI4khGko9WTAnF6hhy/image/h%3D300/sign=bb325138dc58ccbf04bcb33a29dabcd4/aa18972bd40735faee21b63393510fb30e240862.jpg" alt="圆"> </div> <div class="imgWrap"> <img src="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2078115416,2122881389&fm=11&gp=0.jpg"  alt="线"> </div> <div class="imgWrap"><img src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=792977951,797098830&fm=11&gp=0.jpg" alt="女"></div> <div class="imgWrap"><img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3820340004,4042725193&fm=11&gp=0.jpg" alt="男"></div></strong></div><!-- 位&nbsp;&nbsp;&nbsp;置： --><div class="block"><span class="leftTitle">位&nbsp;&nbsp;&nbsp;置：</span><strong class="rightValue">' +
                                child[l].location +
                                '</strong></div></div><div class="rightBlock"><!-- 检查时间： --><div class="block"><span class="leftTitle">检查时间：</span><strong class="rightValue">' +
                                getDay(child[l].uploadTime) +
                                '</strong></div><!-- 复查时间： --><div class="block optionIdIS3"><span class="leftTitle">复查时间：</span><strong class="rightValue optionIdIS3">' +
                                getDay(child[l].reviewTime) +
                                '</strong> </div></div>';
                        }
                        var tables = theader + tbody + "</div>";
                        $(".table").append(tables);
                    }

                } else {
                    alert(response.data.message);
                    // window.close();
                    return
                }
            }

        })




        // 打印
        document.getElementsByTagName("input")[0].onclick = function aa() {
            window.print();
        }


    }

    function danger() {
        // correctCount:当场纠正数量
        // reviewCount:限期整改数量PS:如果 当场纠正&限期整改 都为0,说明无隐患
        obj.correctCount = 1;
        obj.reviewCount = 2;
        if (obj.correctCount == 0 && obj.reviewCount == 0) {
            return ' 无隐患';
        } else if (obj.correctCount == 0 && obj.reviewCount != 0) {
            return " 限期整改 " + obj.reviewCount;
        } else if (obj.correctCount != 0 && obj.reviewCount == 0) {
            return " 当场纠正 " + obj.correctCount;
        } else {
            return " 当场纠正 " + obj.correctCount + "&emsp;限期整改 " + obj.reviewCount;
        }
    }

    // 获取cookie
    function getCookie(cname) {
        var name = cname + "=";
        var Cookies = document.cookie.split(';');
        for (var key in Cookies) {
            var cookie = myTrim(Cookies[key]);
            if (cookie.indexOf(name) == 0) {
                return cookie.substring(name.length, cookie.length);
            }
        }
        return ""
    }
    // 对象
    function getName() {
        var name = getCookie("data");
        var strs = name.split("&");
        for (var i = 0; i < strs.length; i++) {
            var name = unescape(strs[i].split("=")[0]);
            var value = unescape(strs[i].split("=")[1]);
            obj[name] = value;
        }
    }
    // 去掉两端空格
    function myTrim(x) {
        return x.replace(/^\s+|\s+$/gm, '');
    }

    function getDay(date) {
        if (date == null) {
            return "";
        }
        var pubtime = new Date(date),
            pubdate = (pubtime.getFullYear()) + "年" +
            (pubtime.getMonth() + 1) + "月" +
            (pubtime.getDate()) + "日 " +
            (pubtime.getHours()) + ":" +
            (pubtime.getMinutes() < 10 ? "0" + pubtime.getMinutes() : pubtime.getMinutes()) + ":" +
            (pubtime.getSeconds() < 10 ? "0" + pubtime.getSeconds() : pubtime.getSeconds());
        return pubdate;

    }

    function SectionToChinese(section) {
        var strIns = '',
            chnStr = '';
        var unitPos = 0;
        var zero = true;
        while (section > 0) {
            var v = section % 10;
            if (v === 0) {
                if (!zero) {
                    zero = true;
                    chnStr = chnNumChar[v] + chnStr;
                }
            } else {
                zero = false;
                strIns = chnNumChar[v];
                strIns += chnUnitChar[unitPos];
                chnStr = strIns + chnStr;
            }
            unitPos++;
            section = Math.floor(section / 10);
        }
        return chnStr;
    }
</script>

</html>